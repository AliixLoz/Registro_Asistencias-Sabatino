<!DOCTYPE html>
<html lang="es">

<head>
  <meta charset="UTF-8">
  <title>Registro de Asistencia</title>
  <style>
    /* Fondo y centrado */
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      font-family: 'Arial', sans-serif;
      display: flex;
      justify-content: center;
      align-items: center;
      text-align: center;
      background-image: url('Quantum.jpg');
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      color: white;
      flex-direction: column;
      padding: 20px;
      box-sizing: border-box;
    }

    h1 {
      font-size: 3em;
      margin-bottom: 20px;
      text-shadow: 2px 2px 5px rgba(0, 0, 0, 0.6);
    }

    #status {
      font-size: 1.5em;
      margin-bottom: 30px;
      text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.5);
    }

    button {
      padding: 20px 40px;
      font-size: 1.5em;
      background: linear-gradient(45deg, #6a11cb, #2575fc);
      color: white;
      border: none;
      border-radius: 15px;
      cursor: pointer;
      box-shadow: 2px 4px 10px rgba(0, 0, 0, 0.5);
      transition: all 0.3s ease;
    }

    button:hover {
      transform: scale(1.1);
      box-shadow: 4px 6px 15px rgba(0, 0, 0, 0.7);
    }

    p {
      margin: 0;
    }
  </style>
</head>

<body>

  <h1>Registro de Asistencia</h1>
  <p id="status">⌛ Obteniendo ubicación, por favor espera...</p>

  <script>
    const latPermitida = 19.327193;
    const lngPermitida = -98.218104;
    const radioPermitido = 100; // metros
    const formURL = "https://docs.google.com/forms/d/e/1FAIpQLSfiG8mCoqCqcFaUDj-iz4kHKlyWP7LG4asp2AAAkEl2tsKeig/viewform?usp=header";

    function calcularDistancia(lat1, lon1, lat2, lon2) {
      const R = 6371000;
      const dLat = (lat2 - lat1) * Math.PI / 180;
      const dLon = (lon2 - lon1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLon / 2) ** 2;
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      return R * c;
    }

    function mostrarBoton() {
      const boton = document.createElement("button");
      boton.innerText = "✅ Registrar asistencia";
      boton.onclick = () => window.open(formURL, "_blank");
      document.body.appendChild(boton);
      document.getElementById("status").style.display = "none";
    }

    function mostrarBloqueo() {
      const status = document.getElementById("status");
      status.innerText = "❌ Ubicación no válida. Solo puedes registrar asistencia desde el lugar autorizado.";
      status.style.color = "#FF6B6B";
    }

    function validarUbicacion() {
      if (!navigator.geolocation) {
        alert("Tu navegador no soporta ubicación");
        return;
      }

      navigator.geolocation.getCurrentPosition(
        (pos) => {
          const lat = pos.coords.latitude;
          const lng = pos.coords.longitude;
          const distancia = calcularDistancia(lat, lng, latPermitida, lngPermitida);

          if (distancia <= radioPermitido) {
            mostrarBoton();
          } else {
            mostrarBloqueo();
          }
        },
        () => {
          const status = document.getElementById("status");
          status.innerText = "⚠️ Debes permitir el acceso a tu ubicación para registrar asistencia.";
          status.style.color = "#FFD93D";
        },
        { enableHighAccuracy: true, timeout: 10000, maximumAge: 0 }
      );
    }

    window.onload = validarUbicacion;
  </script>

</body>

</html>